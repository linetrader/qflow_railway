// prisma/schema/WalletTx.prisma (추가/수정 예시)
model WalletTx {
  id        String         @id @default(cuid())
  userId    String
  tokenCode String
  txType    WalletTxType
  amount    Decimal        @db.Decimal(38, 18)
  status    WalletTxStatus
  memo      String?

  // 체인 추적 보강
  txHash      String?
  logIndex    Int? // ← 추가 (입금 이벤트 중복 방지)
  blockNumber BigInt?
  fromAddress String?
  toAddress   String?

  // 기존 address 필드를 사용한다면 → 삭제/대체 or 유지 정책 결정
  // address   String?

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  token Token @relation(fields: [tokenCode], references: [code], onDelete: Restrict)

  createdAt DateTime @default(now())

  // 멱등 보장 (txHash & logIndex 조합)
  @@unique([txHash, logIndex])
  @@index([userId, createdAt])
  @@index([userId, tokenCode, createdAt])
  @@index([status, createdAt])
}
